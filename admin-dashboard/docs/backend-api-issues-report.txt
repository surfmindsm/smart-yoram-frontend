=====================================================================
                    ë°±ì—”ë“œ API ë¬¸ì œ ìˆ˜ì • ìš”ì²­ì„œ
=====================================================================

ì‘ì„±ì¼: 2025-08-11
ì‘ì„±ì: í”„ë¡ íŠ¸ì—”ë“œ íŒ€
ëŒ€ìƒ: ë°±ì—”ë“œ ê°œë°œíŒ€
í”„ë¡œì íŠ¸: Smart Yoram Admin Dashboard - ì—ì´ì „íŠ¸ ê´€ë¦¬ í™”ë©´

=====================================================================
                          ë¬¸ì œ ìš”ì•½
=====================================================================

ì—ì´ì „íŠ¸ ê´€ë¦¬ í™”ë©´(AIAgentManagement) ë¡œë“œ ì‹œ ë‹¤ìˆ˜ì˜ API ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬
ì‚¬ìš©ì ê²½í—˜ì— ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” ì—ëŸ¬ í•¸ë“¤ë§ì„
í†µí•´ í™”ë©´ì´ ì •ìƒ ì‘ë™í•˜ë„ë¡ ì²˜ë¦¬í–ˆì§€ë§Œ, ê·¼ë³¸ì ì¸ API ë¬¸ì œ í•´ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.

=====================================================================
                      ë°œìƒ ì¤‘ì¸ ì—ëŸ¬ ëª©ë¡
=====================================================================

1. 405 METHOD NOT ALLOWED ì—ëŸ¬
   - ì—”ë“œí¬ì¸íŠ¸: GET /api/v1/church/gpt-config
   - ì—ëŸ¬ ì½”ë“œ: 405 Method Not Allowed  
   - ë°œìƒ ìœ„ì¹˜: AIAgentManagement.tsx:169 -> loadSystemStatus()
   - í˜„ì¬ ìƒíƒœ: church/profileë¡œ ìš°íšŒ ì²˜ë¦¬ë¨
   - ìš”ì²­ì‚¬í•­: í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ GET ë©”ì„œë“œ ì§€ì› ë˜ëŠ” ì˜¬ë°”ë¥¸ ì—”ë“œí¬ì¸íŠ¸ ì•ˆë‚´

2. CORS POLICY ì—ëŸ¬ (ì‹ ê·œ ë°œê²¬)
   - ì—”ë“œí¬ì¸íŠ¸: POST /api/v1/agents/
   - ì—ëŸ¬: No 'Access-Control-Allow-Origin' header is present
   - ë°œìƒ ìœ„ì¹˜: AIAgentManagement.tsx:256 -> handleCreateAgent()
   - ìš”ì²­ ë°©ì‹: POST (ì—ì´ì „íŠ¸ ìƒì„± ì‹œ)
   - ì›ì¸: ë°±ì—”ë“œì—ì„œ CORS í—¤ë” ì„¤ì • ëˆ„ë½
   - ì˜í–¥: ì—ì´ì „íŠ¸ ìƒì„± ê¸°ëŠ¥ ì™„ì „ ì°¨ë‹¨

3. 422 UNPROCESSABLE ENTITY ì—ëŸ¬ë“¤
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 2-1. Agent Templates API                                       â”‚
   â”‚ - ì—”ë“œí¬ì¸íŠ¸: GET /api/v1/agents/templates                     â”‚
   â”‚ - ì—ëŸ¬ ì½”ë“œ: 422 Unprocessable Entity                          â”‚
   â”‚ - ë°œìƒ ìœ„ì¹˜: AIAgentManagement.tsx:151 -> loadTemplates()      â”‚
   â”‚ - ìš”ì²­ ë°©ì‹: GET (ë§¤ê°œë³€ìˆ˜ ì—†ìŒ)                                â”‚
   â”‚ - í˜„ì¬ ìƒíƒœ: ë¹ˆ ë°°ì—´ë¡œ fallback ì²˜ë¦¬                           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 2-2. Usage Statistics API                                      â”‚
   â”‚ - ì—”ë“œí¬ì¸íŠ¸: GET /api/v1/analytics/usage                      â”‚
   â”‚ - ì—ëŸ¬ ì½”ë“œ: 422 Unprocessable Entity                          â”‚
   â”‚ - ë°œìƒ ìœ„ì¹˜: AIAgentManagement.tsx:166 -> loadUsageStats()     â”‚
   â”‚ - ìš”ì²­ ë§¤ê°œë³€ìˆ˜: ?period=current_month                         â”‚
   â”‚ - í˜„ì¬ ìƒíƒœ: ê¸°ë³¸ í†µê³„ê°’ìœ¼ë¡œ fallback ì²˜ë¦¬                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 2-3. ê¸°íƒ€ ì ì¬ì  422 ì—ëŸ¬ APIë“¤                                â”‚
   â”‚ - GET /api/v1/analytics/tokens                                 â”‚
   â”‚ - GET /api/v1/analytics/costs                                  â”‚
   â”‚ - GET /api/v1/analytics/agents/performance                     â”‚
   â”‚ - GET /api/v1/analytics/queries/top                            â”‚
   â”‚ - GET /api/v1/analytics/trends                                 â”‚
   â”‚ - GET /api/v1/agents/                                          â”‚
   â”‚ - GET /api/v1/chat/histories                                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

=====================================================================
                        ìƒì„¸ ì—ëŸ¬ ì •ë³´
=====================================================================

ã€ ì—ëŸ¬ ë°œìƒ íŒ¨í„´ ã€‘
- ëª¨ë“  422 ì—ëŸ¬ëŠ” í™”ë©´ ì´ˆê¸° ë¡œë“œ ì‹œ ë°œìƒ
- ì¸ì¦ í† í°ì€ ì •ìƒì ìœ¼ë¡œ ì „ì†¡ë¨ (Authorization: Bearer {token})
- Content-Type: application/json í—¤ë” í¬í•¨
- ì—ëŸ¬ ë°œìƒ ì‹œ validation error details ë©”ì‹œì§€ í™•ì¸ë¨

ã€ í˜„ì¬ API í˜¸ì¶œ ì½”ë“œ ã€‘
```javascript
// 1. Agent Templates
const response = await api.get('/agents/templates');

// 2. Usage Stats  
const response = await api.get('/analytics/usage', { 
  params: { period: 'current_month' } 
});

// 3. GPT Config (405 ì—ëŸ¬)
const response = await api.get('/church/gpt-config');
```

ã€ í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬ ìƒí™© ã€‘
- ëª¨ë“  APIì— try-catch ì—ëŸ¬ í•¸ë“¤ë§ êµ¬í˜„
- 422/405 ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ê°’/ë¹ˆ ë°°ì—´ ë°˜í™˜
- í™”ë©´ì€ ì •ìƒ ì‘ë™í•˜ì§€ë§Œ ì‹¤ì œ ë°ì´í„° ë¡œë“œ ë¶ˆê°€

=====================================================================
                          ìˆ˜ì • ìš”ì²­ì‚¬í•­
=====================================================================

ã€ ìš°ì„ ìˆœìœ„ 1 - ì¦‰ì‹œ ìˆ˜ì • í•„ìš” ã€‘
1. ğŸ”´ CORS ì •ì±… ì„¤ì • (ê¸´ê¸‰ - ë¶€ë¶„ì ìœ¼ë¡œë§Œ í•´ê²°ë¨)
   âš ï¸ í˜„ì¬ ìƒí™©: GET ìš”ì²­ì€ ì •ìƒ, POST ìš”ì²­ì—ì„œë§Œ CORS ì°¨ë‹¨
   â†’ POST /api/v1/agents/ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ CORS ì—ëŸ¬ ë°œìƒ
   â†’ Access-Control-Allow-Methodsì— POSTê°€ ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ì„¤ì • ë¯¸ì ìš©
   â†’ ë™ì‹œì— 500 Internal Server Errorë„ ë°œìƒ ì¤‘
   â†’ ì¦‰ì‹œ í™•ì¸ ë° ìˆ˜ì • í•„ìš”

2. GET /api/v1/church/gpt-config
   â†’ 405 ì—ëŸ¬ í•´ê²°: GET ë©”ì„œë“œ ì§€ì› ë˜ëŠ” ì˜¬ë°”ë¥¸ ì—”ë“œí¬ì¸íŠ¸ ì œê³µ

3. GET /api/v1/agents/templates  
   â†’ 422 ì—ëŸ¬ í•´ê²°: ë§¤ê°œë³€ìˆ˜ ì—†ëŠ” GET ìš”ì²­ ì‹œ ì •ìƒ ì‘ë‹µ

4. GET /api/v1/analytics/usage?period=current_month
   â†’ 422 ì—ëŸ¬ í•´ê²°: period ë§¤ê°œë³€ìˆ˜ì™€ í•¨ê»˜ ì •ìƒ ì‘ë‹µ

ã€ ìš°ì„ ìˆœìœ„ 2 - í™•ì¸ ë° í…ŒìŠ¤íŠ¸ í•„ìš” ã€‘
4. Analytics APIë“¤ì˜ ë§¤ê°œë³€ìˆ˜ ê²€ì¦ ë¡œì§ í™•ì¸
5. Agents API ë§¤ê°œë³€ìˆ˜ ìš”êµ¬ì‚¬í•­ í™•ì¸  
6. Chat Histories API ë§¤ê°œë³€ìˆ˜ ìš”êµ¬ì‚¬í•­ í™•ì¸

ã€ ìš”ì²­í•˜ëŠ” ì‘ë‹µ í˜•ì‹ ã€‘
```json
// Agent Templates ì˜ˆìƒ ì‘ë‹µ
{
  "templates": [
    {
      "id": "template_id",
      "name": "í…œí”Œë¦¿ ì´ë¦„", 
      "description": "ì„¤ëª…",
      "config": {...}
    }
  ]
}

// Usage Stats ì˜ˆìƒ ì‘ë‹µ  
{
  "total_requests": 0,
  "total_tokens": 0, 
  "total_cost": 0,
  "daily_stats": [],
  "period": "current_month"
}

// GPT Config ì˜ˆìƒ ì‘ë‹µ
{
  "api_key": "sk-...",
  "database_connected": true,
  "last_sync": "2025-08-11T10:00:00Z",
  "model": "gpt-3.5-turbo",
  "max_tokens": 1000,
  "temperature": 0.7,
  "is_active": true
}
```

=====================================================================
                        í…ŒìŠ¤íŠ¸ í™˜ê²½ ì •ë³´
=====================================================================

ã€ API Base URL ã€‘
- ê°œë°œí™˜ê²½: https://api.surfmind-team.com/api/v1
- í”„ë¡ íŠ¸ì—”ë“œ í¬íŠ¸: localhost:3000

ã€ ì¸ì¦ ì •ë³´ ã€‘
- í—¤ë”: Authorization: Bearer {localStorage.token}
- Content-Type: application/json

ã€ í…ŒìŠ¤íŠ¸ ë°©ë²• ã€‘
1. ì—ì´ì „íŠ¸ ê´€ë¦¬ í™”ë©´(/agent-management) ì ‘ì†
2. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ API í˜¸ì¶œ í™•ì¸
3. 422/405 ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ í™•ì¸

=====================================================================
                          ì¶”ê°€ ì •ë³´
=====================================================================

ã€ í˜„ì¬ ì •ìƒ ì‘ë™í•˜ëŠ” APIë“¤ ã€‘
- POST /api/v1/auth/login/access-token (ë¡œê·¸ì¸)
- GET /api/v1/users/me (ì‚¬ìš©ì ì •ë³´)
- GET /api/v1/church/profile (êµíšŒ í”„ë¡œí•„)

ã€ Supabase Edge Function ì‚¬ìš© ì¤‘ì¸ ê¸°ëŠ¥ ã€‘  
- ì œëª© ìƒì„±: https://adzhdsajdamrflvybhxq.supabase.co/functions/v1/generate-title
- ê¸°íƒ€ ê¸°ëŠ¥ë“¤ì€ api.surfmind-team.com ì‚¬ìš©

ã€ ì—°ë½ì²˜ ã€‘
- í”„ë¡ íŠ¸ì—”ë“œ íŒ€: [ì—°ë½ì²˜]
- ê¸´ê¸‰ ìƒí™© ì‹œ: [ì—°ë½ì²˜]

=====================================================================

ì´ ë¬¸ì„œëŠ” ì—ì´ì „íŠ¸ ê´€ë¦¬ í™”ë©´ì˜ API ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ë¹ ë¥¸ ìˆ˜ì •ì„ í†µí•´ ì‚¬ìš©ì ê²½í—˜ ê°œì„ ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ì‘ì„± ì™„ë£Œ: 2025-08-11 22:16
